<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>单选外部选项测试</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      background: #fff;
      color: #222;
      padding: 1.2rem;
    }
    h3 { margin-bottom: 1rem; }
    .option {
      padding: .6rem .8rem;
      border: 1px solid #ddd;
      border-radius: .5rem;
      margin-bottom: .6rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: .5rem;
    }
    .option input {
      width: 1rem;
      height: 1rem;
    }
    button {
      margin-top: 1rem;
      padding: .6rem 1.2rem;
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: .4rem;
      font-size: .9rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h3>请选择一个选项（A/B/C）</h3>
  <div id="options"></div>
  <button id="okBtn">确定</button>

  <script>
    // 1. 解析企业微信传过来的参数
    const url = new URL(location.href);
    const key = url.searchParams.get('key') || '';
    const selectorType = url.searchParams.get('selectorType') || 'single';

    // 2. 模拟单选项数据
    const data = [
      { id: 'a', name: 'A' },
      { id: 'b', name: 'B' },
      { id: 'c', name: 'C' }
    ];
    let selectedId = null;

    const listEl = document.getElementById('options');

    // 3. 如果支持接口，先获取已选项
    if (typeof ww !== 'undefined' && ww.getApprovalSelectedItems) {
      ww.getApprovalSelectedItems({
        key,
        success(res) {
          if (res.items && res.items[0]) {
            selectedId = res.items[0].id;
          }
          render();
        },
        fail() { render(); }
      });
    } else {
      render();
    }

    // 渲染列表
    function render() {
      listEl.innerHTML = '';
      data.forEach(item => {
        const div = document.createElement('div');
        div.className = 'option';
        div.innerHTML = `
          <input type="radio" name="opt" value="${item.id}" ${item.id === selectedId ? 'checked' : ''}/>
          <label>${item.name}</label>
        `;
        div.addEventListener('click', () => {
          selectedId = item.id;
          render();
        });
        listEl.appendChild(div);
      });
    }

    // 4. 点击确定保存选择
    document.getElementById('okBtn').onclick = function () {
      const items = selectedId ? [{ id: selectedId, name: selectedId.toUpperCase() }] : [];
      if (typeof ww !== 'undefined' && ww.saveApprovalSelectedItems) {
        ww.saveApprovalSelectedItems({
          key,
          items,
          success() { /* 企业微信自动关闭窗口 */ },
          fail(err) { alert('保存失败: ' + JSON.stringify(err)); }
        });
      } else {
        // 本地调试用
        alert('选中了: ' + selectedId);
      }
    };
  </script>
</body>
</html>
